include Makefile.inc

THISLIB = Directory

HSSRCS	= RenameFile.hs
GCSRCS	= PatchIOError.gc DoesFileExist.gc DoesDirectoryExist.gc \
	  GetModificationTime.gc RemoveFile.gc \
	  CreateDirectory.gc RemoveDirectory.gc RenameDirectory.gc \
	  SetCurrentDirectory.gc GetCurrentDirectory.gc \
	  GetDirectoryContents.gc \
	  DPermissions.gc SetPermissions.gc GetPermissions.gc


OBJDIR = ${BUILDDIR}/${OBJ}/prelude/${THISLIB}
MAINSRC = ${THISLIB}.hs


HSOBJS = $(patsubst %.hs,${OBJDIR}/%.o,${HSSRCS})
GCOBJS = $(patsubst %.gc,${OBJDIR}/%.o,${GCSRCS})
MAINOBJ = $(patsubst %.hs,${OBJDIR}/%.o,${MAINSRC})
OBJS = ${HSOBJS} ${GCOBJS}

HSCFILES = $(patsubst %.hs,%.c,${HSSRCS})
GCCFILES = $(patsubst %.gc,%.c,${GCSRCS})
MAINCFILE = $(patsubst %.hs,%.c,${MAINSRC})
CFILES = ${HSCFILES} ${GCCFILES}

HFLAGS = -P../Time -P../PreludeIO
#HEAP = +RTS -H2M -RTS


all:  ${OBJS} ${MAINOBJ}
boot: ${OBJS} ${MAINOBJ}
cfiles: ${CFILES} ${MAINCFILE}
fromC:
	$(HC) -c -d $(OBJDIR) *.c
${OBJDIR}:
	mkdir -p ${OBJDIR}
objdir: ${OBJDIR}
${MAINOBJ}: ${OBJS}
clean:
	rm -f ${OBJDIR}/*.o *.hi *.o *_.hs *.c *.s


 
.SUFFIXES: .hs .gc .o .c
#.hs.o:
#	$(HC) -c $(HFLAGS) $<

${HSOBJS}: ${OBJDIR}/%.o : %.hs
	$(HC) -c  -part -o $@ $<
${GCOBJS}: ${OBJDIR}/%.o : %.gc
	$(HC) -c  -P../Time/ -P../PreludeIO/ -part -o $@ $<
${MAINOBJ}: ${OBJDIR}/%.o : %.hs
	$(HC) -c +CTS -lib -CTS -o $@ $<

${HSCFILES}: %.c : %.hs
	$(HC) -C -part $<
${GCCFILES}: %.c : %.gc
	$(HC) -C -P../Time/ -P../PreludeIO/ -part $<
${MAINCFILE}: %.c : %.hs
	$(HC) -C +CTS -lib -CTS $<


# I know that they depend on .hi, but make is stupid :-(

# dependencies generated by hmake -Md:
${OBJDIR}/SetPermissions.o: ${OBJDIR}/PatchIOError.o ${OBJDIR}/DPermissions.o 
${OBJDIR}/GetPermissions.o: ${OBJDIR}/PatchIOError.o ${OBJDIR}/DPermissions.o 
${OBJDIR}/GetModificationTime.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/DoesDirectoryExist.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/DoesFileExist.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/SetCurrentDirectory.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/GetCurrentDirectory.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/RenameFile.o: ${OBJDIR}/RenameDirectory.o 
${OBJDIR}/RemoveFile.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/RenameDirectory.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/RemoveDirectory.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/CreateDirectory.o: ${OBJDIR}/PatchIOError.o 
${OBJDIR}/GetDirectoryContents.o: ${OBJDIR}/PatchIOError.o 
