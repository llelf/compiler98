include Makefile.inc

THISLIB = Time

HSSRCS	= DTimeDiff.hs AddToClockTime.hs DiffClockTimes.hs \
          FormatCalendarTime.hs CalendarTimeToString.hs
GCSRCS	= DDay.gc DMonth.gc DClockTime.gc DCalendarTime.gc \
	  GetClockTime.gc ToCalendarTime.gc ToClockTime.gc \
	  ToUTCTime.gc


OBJDIR = ${BUILDDIR}/${OBJ}/prelude/${THISLIB}
MAINSRC	= ${THISLIB}.hs

HSOBJS = $(patsubst %.hs,${OBJDIR}/%.o,${HSSRCS})
GCOBJS = $(patsubst %.gc,${OBJDIR}/%.o,${GCSRCS})
MAINOBJ = $(patsubst %.hs,${OBJDIR}/%.o,${MAINSRC})
OBJS = ${GCOBJS} ${HSOBJS}

HSCFILES = $(patsubst %.hs,%.c,${HSSRCS})
GCCFILES = $(patsubst %.gc,%.c,${GCSRCS})
MAINCFILE = $(patsubst %.hs,%.c,${MAINSRC})
CFILES = ${GCCFILES} ${HSCFILES}

HFLAGS = -P./ -P../Locale/ -P../NonStd/ -part -redefine


all: ${OBJS} ${MAINOBJ}
boot:
cfiles: ${CFILES} ${MAINCFILE}
fromC:
	$(HC) -c -d $(OBJDIR) *.c
${OBJDIR}:
	mkdir -p ${OBJDIR}
objdir: ${OBJDIR}
${MAINOBJ}: ${OBJS}
clean:
	rm -f ${OBJDIR}/*.o *.o *.hi *.c *.s *_.hs


 
.SUFFIXES: .hs .o .gc .c

${HSOBJS}: ${OBJDIR}/%.o : %.hs
	$(HC) -c $(HFLAGS) -o $@ $<
${GCOBJS}: ${OBJDIR}/%.o : %.gc
	$(HC) -c $(HFLAGS) -o $@ $<
${MAINOBJ}: ${OBJDIR}/%.o : %.hs
	$(HC) -c +CTS -lib -CTS -o $@ $<

${HSCFILES}: %.c : %.hs
	$(HC) -C $(HFLAGS) $<
${GCCFILES}: %.c : %.gc
	$(HC) -C $(HFLAGS) $<
${MAINCFILE}: %.c : %.hs
	$(HC) -C +CTS -lib -CTS $<


# dependencies (can be generated by hmake)
${OBJDIR}/FormatCalendarTime.o: FormatCalendarTime.hs ${OBJDIR}/DCalendarTime.o 
${OBJDIR}/CalendarTimeToString.o: CalendarTimeToString.hs ${OBJDIR}/DCalendarTime.o ${OBJDIR}/FormatCalendarTime.o 
${OBJDIR}/ToClockTime.o: ToClockTime.gc ${OBJDIR}/DClockTime.o ${OBJDIR}/DCalendarTime.o 
${OBJDIR}/ToUTCTime.o: ToUTCTime.gc ${OBJDIR}/DClockTime.o ${OBJDIR}/DCalendarTime.o 
${OBJDIR}/ToCalendarTime.o: ToCalendarTime.gc ${OBJDIR}/DClockTime.o ${OBJDIR}/DCalendarTime.o 
${OBJDIR}/DiffClockTimes.o: DiffClockTimes.hs ${OBJDIR}/DClockTime.o ${OBJDIR}/DTimeDiff.o 
${OBJDIR}/AddToClockTime.o: AddToClockTime.hs ${OBJDIR}/DTimeDiff.o ${OBJDIR}/DClockTime.o 
${OBJDIR}/GetClockTime.o: GetClockTime.gc ${OBJDIR}/DClockTime.o 
${OBJDIR}/DCalendarTime.o: DCalendarTime.gc ${OBJDIR}/DMonth.o ${OBJDIR}/DDay.o 

GetClockTime.c: DClockTime.c
