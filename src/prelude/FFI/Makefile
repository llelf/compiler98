include Makefile.inc

THISLIB = FFI

SRCS	= \
	Addr.hs FixIO.hs ForeignObj.hs \
	Ptr.hs ShowsIntBase.hs StablePtr.hs

NotYetSRCS = Int.hs


OBJDIR = ${BUILDDIR}/${OBJ}/prelude/${THISLIB}
MAINSRC = ${THISLIB}.hs

OBJS = $(patsubst %.hs,${OBJDIR}/%.o,${SRCS})
MAINOBJ = $(patsubst %.hs,${OBJDIR}/%.o,${MAINSRC})
CFILES = $(patsubst %.hs,%.c,${SRCS})
MAINCFILE = $(patsubst %.hs,%.c,${MAINSRC})
HIFILES = $(patsubst %.hs, %.hi, ${SRCS} ${MAINSRC})

#HFLAGS = -part -prelude -redefine


all:  ${OBJS} ${MAINOBJ}
boot: ${OBJS} ${MAINOBJ}
cfiles: ${CFILES} ${MAINCFILE}
fromC:
	$(HC) -c -d $(OBJDIR) ${CFILES} ${MAINCFILE}
${OBJDIR}:
	mkdir -p ${OBJDIR}
objdir: ${OBJDIR}
${MAINOBJ}: ${OBJS}
clean:
	rm -f ${OBJDIR}/*.o ${HIFILES} *.o *.c *.s



${OBJS} ${MAINOBJ}: ${OBJDIR}/%.o : %.hs
	$(HC) -c $(HFLAGS) -o $@ $<

${CFILES} ${MAINCFILE}: %.c : %.hs
	$(HC) -C $(HFLAGS) $<

.SUFFIXES: .hs .o .c .hi

# I know that they depoend on .hi, but make is stupid :-(

# dependencies generated by hmake -Md:
# (and hacked by MW)
${OBJDIR}/Addr.o: ${OBJDIR}/ShowsIntBase.o 
